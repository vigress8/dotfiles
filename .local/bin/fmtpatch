#!/usr/bin/env cached-nix-shell
#!nix-shell --pure -i bash
#!nix-shell -p diffutils perl

diff -u "$2" <(perl -pe "$1" "$2") \
    | perl -pe 'BEGIN { my $f };
        m#^(?:---|\+\+\+) # and s#\t.*##;
        s#^(---) /?(.+)#$1 old/$2# and $f = $2;
        s#^(\+\+\+) .+#$1 new/$f#'

# vim: set ft=sh ts=2 sw=2 et:
